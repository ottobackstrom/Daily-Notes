<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <title>Elevlogg</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <!-- iPhone App-st√∂d -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Skolg√•ngshandledarappen" />
  <meta name="theme-color" content="#F2F2F7" />
  <link rel="apple-touch-icon" href="icon-193.png" />
  <link rel="manifest" href="manifest.webmanifest" />

  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --ios-bg: #f2f2f7;
      --ios-surface: #ffffff;
      --ios-separator: rgba(60, 60, 67, 0.29);
      --ios-secondary: rgba(60, 60, 67, 0.6);
      --ios-label: #000000;
      --ios-accent: #007aff;
      --ios-destructive: #ff3b30;
      --ios-success: #34c759;
      --radius-pill: 999px;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: var(--ios-bg);
      color: var(--ios-label);
    }

    .app {
      width: 100%;
      max-width: none;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--ios-bg);
    }

    /* ======= TOPP-NAV BAR ======= */

    .nav-bar {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(242, 242, 247, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 0.5px solid var(--ios-separator);
      padding: 0.5rem 0.75rem 0.45rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .nav-row {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .nav-title-container {
      text-align: center;
    }

    .nav-title {
      font-size: 17px;
      font-weight: 600;
      line-height: 1.2;
    }

    .nav-subtitle {
      font-size: 11px;
      color: var(--ios-secondary);
    }

    /* ======= FLIKAR ======= */

    .tabs-shell {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tabs-container {
      flex: 1;
      display: flex;
      overflow-x: auto;
      gap: 0.25rem;
      padding-bottom: 0.1rem;
      scrollbar-width: none;
    }

    .tabs-container::-webkit-scrollbar {
      display: none;
    }

    .tab {
      border-radius: var(--radius-pill);
      border: 0.5px solid transparent;
      background: #e5e5ea;
      color: #3c3c43;
      font-size: 13px;
      padding: 0.25rem 0.7rem;
      white-space: nowrap;
      flex: 0 0 auto;
    }

    .tab.active {
      background: var(--ios-surface);
      border-color: var(--ios-separator);
      color: var(--ios-accent);
      font-weight: 600;
      box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    }

    .tab-add {
      flex: 0 0 auto;
      border-radius: 999px;
      border: none;
      background: #e5e5ea;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .tab:active,
    .tab-add:active {
      opacity: 0.8;
    }

    /* ======= INNEH√ÖLL ======= */

    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0.5rem 0.75rem 0.75rem;
      gap: 0.45rem;
    }

    .hint {
      font-size: 12px;
      color: var(--ios-secondary);
      padding: 0 0.25rem;
    }

    /* Rich text-logg ist√§llet f√∂r textarea */
    #notes {
      margin-top: 0.25rem;
      flex: 1;
      width: 100%;
      border: none;
      border-radius: 12px;
      padding: 0.75rem 0.75rem;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      font-size: 15px;
      line-height: 1.4;
      background: var(--ios-surface);
      color: var(--ios-label);
      outline: none;
      box-shadow: 0 0 0 0.5px rgba(60,60,67,0.15);
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    #notes:focus {
      box-shadow: 0 0 0 1px rgba(0,122,255,0.5);
    }

    /* F√§rgade beteenden */
    .behavior-red {
      color: var(--ios-destructive);
      font-weight: 600;
    }
    .behavior-green {
      color: var(--ios-success);
      font-weight: 600;
    }

    /* ======= NEDRE VERKTYGSPANEL ======= */

    .bottom-toolbar {
      position: sticky;
      bottom: 0;
      z-index: 5;
      background: rgba(242, 242, 247, 0.97);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 0.5px solid var(--ios-separator);
      padding: 0.45rem 0.75rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
    }

    .bottom-section {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .bottom-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--ios-secondary);
    }

    .bottom-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      align-items: center;
    }

    /* App-kontrollknappar */
    .control-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      border-radius: var(--radius-pill);
      border: 0.5px solid rgba(60,60,67,0.25);
      background: var(--ios-surface);
      font-size: 12px;
      padding: 0.25rem 0.6rem;
      color: #3c3c43;
    }

    .control-btn .icon {
      font-size: 13px;
    }

    .control-btn.destructive {
      color: var(--ios-destructive);
      border-color: rgba(255,59,48,0.35);
    }

    .control-btn:active {
      background: #e5e5ea;
    }

    .control-btn.primary {
      color: var(--ios-accent);
      border-color: rgba(0,122,255,0.45);
    }

    /* Snabbknappar f√∂r beteende */
    .chip-btn {
      border-radius: var(--radius-pill);
      border: 0.5px solid rgba(60,60,67,0.2);
      padding: 0.25rem 0.7rem;
      background: var(--ios-surface);
      font-size: 12px;
      color: #3c3c43;
    }

    .chip-btn.destructive {
      color: var(--ios-destructive);
      border-color: rgba(255,59,48,0.3);
    }

    .chip-btn.success {
      color: var(--ios-success);
      border-color: rgba(52,199,89,0.3);
    }

    .chip-btn:active {
      background: #e5e5ea;
    }

    .bottom-label {
      font-size: 11px;
      color: var(--ios-secondary);
      margin-top: 0.15rem;
    }

    /* ======= DARK MODE ======= */

    body.dark {
      background: #000000;
    }

    body.dark .app {
      background: #000000;
    }

    body.dark .nav-bar,
    body.dark .bottom-toolbar {
      background: rgba(22, 22, 24, 0.94);
      border-color: rgba(84, 84, 88, 0.65);
    }

    body.dark .nav-title,
    body.dark .bottom-section-title,
    body.dark .hint,
    body.dark .bottom-label {
      color: rgba(235, 235, 245, 0.9);
    }

    body.dark .nav-subtitle {
      color: rgba(235, 235, 245, 0.75);
    }

    body.dark .content {
      background: #000000;
    }

    body.dark #notes {
      background: #1c1c1e;
      color: #ffffff;
      box-shadow: 0 0 0 0.5px rgba(84,84,88,0.6);
    }

    body.dark .tab {
      background: #3a3a3c;
      color: #f2f2f7;
    }

    body.dark .tab.active {
      background: #1c1c1e;
      color: #0a84ff;
      border-color: rgba(84,84,88,0.6);
    }

    body.dark .tab-add {
      background: #3a3a3c;
      color: #f2f2f7;
    }

    body.dark .control-btn {
      background: #1c1c1e;
      color: #f2f2f7;
      border-color: rgba(84,84,88,0.6);
    }

    body.dark .chip-btn {
      background: #1c1c1e;
      border-color: rgba(84,84,88,0.6);
    }

    body.dark .chip-btn.destructive {
      color: #ff453a;
      border-color: rgba(255,69,58,0.8);
      background: rgba(255,69,58,0.16);
    }

    body.dark .chip-btn.success {
      color: #30d158;
      border-color: rgba(48,209,88,0.8);
      background: rgba(48,209,88,0.16);
    }

    body.dark .behavior-red {
      color: #ff453a;
    }

    body.dark .behavior-green {
      color: #30d158;
    }

    /* ======= UTSKRIFT (PDF) ======= */
    @media print {
      body {
        background: #ffffff;
      }
      .nav-bar,
      .bottom-toolbar {
        display: none;
      }
      .content {
        padding: 0;
      }
      #notes {
        box-shadow: none;
        border-radius: 0;
      }
    }

  </style>
</head>

<body>
  <div class="app">

    <!-- NAV BAR -->
    <header class="nav-bar">
      <div class="nav-row">
        <div class="nav-title-container">
          <div class="nav-title">Elevlogg</div>
          <div class="nav-subtitle" id="currentTabTitle">Elev 1</div>
        </div>
      </div>

      <!-- Flikar -->
      <div class="tabs-shell">
        <div class="tabs-container" id="tabs"></div>
        <button class="tab-add" id="addTabBtn" type="button">Ôºã</button>
      </div>
    </header>

    <!-- INNEH√ÖLL -->
    <main class="content">
      <p class="hint">
        Varje ny rad b√∂rjar automatiskt med aktuell tid (HH:MM). Anv√§nd flikarna f√∂r olika elever.
      </p>
      <!-- contenteditable ist√§llet f√∂r textarea -->
      <div id="notes" contenteditable="true"></div>
    </main>

    <!-- NEDRE VERKTYGSPANEL -->
    <footer class="bottom-toolbar">
      <div class="bottom-label" id="infoLabel">Automatisk tidsst√§mpel aktiv</div>

      <!-- App-kontroller -->
      <div class="bottom-section">
        <div class="bottom-section-title">App-kontroller</div>
        <div class="bottom-row">
          <button class="control-btn primary" id="renameTabBtn" type="button">
            <span class="icon">‚úèÔ∏è</span><span>Byt namn</span>
          </button>
          <button class="control-btn destructive" id="deleteTabBtn" type="button">
            <span class="icon">üóëÔ∏è</span><span>Ta bort flik</span>
          </button>
          <button class="control-btn" id="insertDateBtn" type="button">
            <span class="icon">üìÖ</span><span>Datum</span>
          </button>
          <button class="control-btn" id="exportBtn" type="button">
            <span class="icon">‚¨áÔ∏è</span><span>Export .txt</span>
          </button>
          <button class="control-btn" id="exportHtmlBtn" type="button">
            <span class="icon">üåà</span><span>Export f√§rg-HTML</span>
          </button>
          <button class="control-btn" id="printBtn" type="button">
            <span class="icon">üñ®Ô∏è</span><span>PDF / Skriv ut</span>
          </button>
          <button class="control-btn" id="themeToggleBtn" type="button">
            <span class="icon" id="themeIcon">‚òÄÔ∏è</span><span>Tema</span>
          </button>
          <button class="control-btn" id="toggleColorBtn" type="button">
            <span class="icon">üé®</span><span id="colorModeLabel">F√§rgade beteenden: P√•</span>
          </button>
        </div>
      </div>

      <!-- Beteende-snabbknappar -->
      <div class="bottom-section">
        <div class="bottom-section-title">Snabbknappar ‚Äì beteende</div>
        <div class="bottom-row">
          <button class="chip-btn destructive quick-btn" type="button" data-label="Sl√•ss">Sl√•ss</button>
          <button class="chip-btn destructive quick-btn" type="button" data-label="Anv√§nder fula ord">Fula ord</button>
          <button class="chip-btn destructive quick-btn" type="button" data-label="Tjafsar emot">Tjafsar emot</button>
          <button class="chip-btn destructive quick-btn" type="button" data-label="Uppe och g√•r">Uppe och g√•r</button>
          <button class="chip-btn destructive quick-btn" type="button" data-label="F√∂ljer ej instruktion">F√∂ljer ej instruktioner</button>
          <button class="chip-btn destructive quick-btn" type="button" data-label="Pratar rakt ut">Pratar rakt ut</button>
          <button class="chip-btn success quick-btn" type="button" data-label="Ber om urs√§kt">Ber om urs√§kt</button>
          <button class="chip-btn success quick-btn" type="button" data-label="R√§cker upp handen">R√§cker upp handen</button>
        </div>
      </div>
    </footer>
  </div>

  <script>
    const STORAGE_KEY = 'timeNotesApp_v1';
    const THEME_KEY = 'timeNotesApp_theme';
    const COLOR_KEY = 'timeNotesApp_colorBehaviors';
    const ACCESS_KEY = 'elevlogg_access_v1';   // l√∂senordsflagga i localStorage
    const PASSWORD = '1234';                   // byt till ditt eget "l√∂senord"

    let state = { tabs: [], activeId: null };
    let colorBehaviors = true;

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function currentTimeString() {
      const d = new Date();
      return `${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")} `;
    }

    function currentDateHeading() {
      const d = new Date();
      const veckodagar = [
        "S√∂ndag", "M√•ndag", "Tisdag", "Onsdag",
        "Torsdag", "Fredag", "L√∂rdag"
      ];
      const m√•nader = [
        "januari", "februari", "mars", "april",
        "maj", "juni", "juli", "augusti",
        "september", "oktober", "november", "december"
      ];
      const dag = veckodagar[d.getDay()];
      const datum = d.getDate();
      const m√•nad = m√•nader[d.getMonth()];
      const √•r = d.getFullYear();
      return `${dag} ${datum} ${m√•nad} ${√•r}`;
    }

    function loadState() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try { state = JSON.parse(raw); }
        catch { state = { tabs: [], activeId: null }; }
      }
      if (!state.tabs || state.tabs.length === 0) {
        const id = String(Date.now());
        state.tabs = [{ id, name: "Elev 1", content: "" }];
        state.activeId = id;
        saveState();
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function getActiveTab() {
      return state.tabs.find(t => t.id === state.activeId);
    }

    function updateNavSubtitle() {
      const t = getActiveTab();
      const el = document.getElementById('currentTabTitle');
      if (el && t) el.textContent = t.name;
    }

    function renderTabs(container, editor) {
      container.innerHTML = "";
      state.tabs.forEach(tab => {
        const b = document.createElement("button");
        b.className = "tab" + (tab.id === state.activeId ? " active" : "");
        b.textContent = tab.name;
        b.type = "button";
        b.onclick = () => switchTab(tab.id, container, editor);
        container.appendChild(b);
      });
      updateNavSubtitle();
    }

    function switchTab(id, container, editor) {
      const current = getActiveTab();
      if (current) current.content = editor.innerHTML;
      state.activeId = id;
      saveState();
      const next = getActiveTab();
      editor.innerHTML = next.content || "";
      ensureFirstLineHasDateAndTime(editor);
      renderTabs(container, editor);
    }

    function addTab(container, editor) {
      const name = prompt("Namn p√• ny elev:");
      if (!name) return;
      const id = Date.now() + "_" + Math.random().toString(16).slice(2);
      state.tabs.push({ id, name: name.trim(), content: "" });
      state.activeId = id;
      saveState();
      renderTabs(container, editor);
      editor.innerHTML = "";
      ensureFirstLineHasDateAndTime(editor);
    }

    function renameTab(container) {
      const t = getActiveTab();
      if (!t) return;
      const n = prompt("Nytt namn p√• fliken:", t.name);
      if (!n) return;
      t.name = n.trim();
      saveState();
      renderTabs(container, document.getElementById("notes"));
    }

    function deleteTab(container, editor) {
      if (state.tabs.length <= 1) {
        alert("Minst en flik kr√§vs.");
        return;
      }
      const t = getActiveTab();
      if (!confirm("Ta bort fliken: " + t.name + "?")) return;
      state.tabs = state.tabs.filter(x => x.id !== t.id);
      state.activeId = state.tabs[0].id;
      saveState();
      renderTabs(container, editor);
      editor.innerHTML = getActiveTab().content || "";
      ensureFirstLineHasDateAndTime(editor);
    }

    function ensureFirstLineHasDateAndTime(editor) {
      if (!editor.innerText.trim()) {
        const date = escapeHtml(currentDateHeading());
        const time = escapeHtml(currentTimeString());
        editor.innerHTML = `${date}<br>${time}`;
      }
    }

    function placeCaretAtEnd(el) {
      el.focus();
      const range = document.createRange();
      range.selectNodeContents(el);
      range.collapse(false);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
    }

    // Datumknapp ‚Äì ingen extra "blank rad", bara normal radbrytning
    function insertDateHeadingAtEnd(editor) {
      // Ta bort eventuella <br> p√• slutet
      let html = editor.innerHTML.replace(/(<br>\s*)+$/g, "");

      const date = escapeHtml(currentDateHeading());
      const time = escapeHtml(currentTimeString());

      const prefix = html ? "<br>" : ""; // radbyte f√∂re datum om n√•got finns

      editor.innerHTML = html + `${prefix}${date}<br>${time}`;

      placeCaretAtEnd(editor);

      const t = getActiveTab();
      if (t) {
        t.content = editor.innerHTML;
        saveState();
      }
    }

    function behaviorClassForLabel(label) {
      const green = ["Ber om urs√§kt", "R√§cker upp handen"];
      if (green.includes(label)) return "behavior-green";
      return "behavior-red";
    }

    function insertQuickEntry(label, editor) {
      const timeStr = currentTimeString();
      const prefix = editor.innerHTML.trim() ? "<br><br>" : "";

      let labelHtml = "";
      if (label) {
        if (colorBehaviors) {
          const cls = behaviorClassForLabel(label);
          labelHtml = ` <span class="${cls}">${escapeHtml(label)}</span>`;
        } else {
          labelHtml = " " + escapeHtml(label);
        }
      }

      const html = `${prefix}${escapeHtml(timeStr)}${labelHtml}`;
      editor.innerHTML = editor.innerHTML + html;
      placeCaretAtEnd(editor);

      const t = getActiveTab();
      if (t) {
        t.content = editor.innerHTML;
        saveState();
      }
    }

    function exportCurrentTab(editor) {
      const tab = getActiveTab();
      if (!tab) return;

      const elevNamn = tab.name || "Ok√§nd elev";
      const header = `Elev: ${elevNamn}\n\n`;
      const body = editor.innerText || "";
      const text = header + body;

      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const filename = (elevNamn || "anteckning").replace(/\W+/g, "_") + ".txt";

      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    function exportCurrentTabHtml(editor) {
      const tab = getActiveTab();
      if (!tab) return;

      const elevNamn = tab.name || "Ok√§nd elev";
      const safeName = (elevNamn || "anteckning").replace(/\W+/g, "_");
      const filename = safeName + "_farg.html";

      const doc =
        `<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8">
<title>Elevlogg ‚Äì ${escapeHtml(elevNamn)}</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    white-space: pre-wrap;
    background: #f2f2f7;
    color: #000;
    padding: 1rem;
  }
  h1 {
    font-size: 1.2rem;
    margin-bottom: 0.8rem;
  }
  .behavior-red {
    color: #ff3b30;
    font-weight: 600;
  }
  .behavior-green {
    color: #34c759;
    font-weight: 600;
  }
</style>
</head>
<body>
<h1>Elev: ${escapeHtml(elevNamn)}</h1>
<div>
${editor.innerHTML}
</div>
</body>
</html>`;

      const blob = new Blob([doc], { type: "text/html;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    function loadTheme() {
      return localStorage.getItem(THEME_KEY) || "light";
    }

    function saveTheme(t) {
      localStorage.setItem(THEME_KEY, t);
    }

    function applyTheme(t) {
      const dark = t === "dark";
      document.body.classList.toggle("dark", dark);
      const iconSpan = document.getElementById("themeIcon");
      if (iconSpan) iconSpan.textContent = dark ? "üåô" : "‚òÄÔ∏è";
    }

    function loadColorPref() {
      const raw = localStorage.getItem(COLOR_KEY);
      if (raw === null) return true;
      return raw === "true";
    }

    function saveColorPref(val) {
      localStorage.setItem(COLOR_KEY, String(val));
    }

    function updateColorToggleLabel() {
      const el = document.getElementById("colorModeLabel");
      if (!el) return;
      el.textContent = colorBehaviors ? "F√§rgade beteenden: P√•" : "F√§rgade beteenden: Av";
    }

    // Enkel l√∂senordssp√§rr (f√∂rsta g√•ngen per webbl√§sare)
    function checkAccess() {
      const unlocked = localStorage.getItem(ACCESS_KEY);
      if (unlocked === 'true') {
        return true;
      }

      let tries = 0;
      while (tries < 3) {
        const input = prompt('Ange l√∂senord f√∂r att √∂ppna Elevloggen:');
        if (input === null) {
          break;
        }
        if (input === PASSWORD) {
          localStorage.setItem(ACCESS_KEY, 'true');
          return true;
        }
        alert('Fel l√∂senord, f√∂rs√∂k igen.');
        tries++;
      }

      document.body.innerHTML = '<p style="font-family:-apple-system;padding:1rem;">√Ötkomst nekad.</p>';
      return false;
    }

    // Stoppa pinch-zoom
    document.addEventListener('touchmove', function (event) {
      if (event.touches.length > 1) {
        event.preventDefault();
      }
    }, { passive: false });

    // Stoppa dubbel-tap-zoom
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    window.onload = () => {
      // L√∂senord f√∂rst
      if (!checkAccess()) {
        return;
      }

      const editor = document.getElementById("notes");
      const tabs = document.getElementById("tabs");
      const addTabBtn = document.getElementById("addTabBtn");
      const renameTabBtn = document.getElementById("renameTabBtn");
      const deleteTabBtn = document.getElementById("deleteTabBtn");
      const insertDateBtn = document.getElementById("insertDateBtn");
      const exportBtn = document.getElementById("exportBtn");
      const exportHtmlBtn = document.getElementById("exportHtmlBtn");
      const printBtn = document.getElementById("printBtn");
      const themeToggleBtn = document.getElementById("themeToggleBtn");
      const toggleColorBtn = document.getElementById("toggleColorBtn");

      loadState();
      renderTabs(tabs, editor);
      editor.innerHTML = getActiveTab().content || "";
      ensureFirstLineHasDateAndTime(editor);

      // Tema
      let theme = loadTheme();
      applyTheme(theme);
      themeToggleBtn.onclick = () => {
        theme = theme === "dark" ? "light" : "dark";
        applyTheme(theme);
        saveTheme(theme);
      };

      // F√§rgade beteenden
      colorBehaviors = loadColorPref();
      updateColorToggleLabel();
      toggleColorBtn.onclick = () => {
        colorBehaviors = !colorBehaviors;
        saveColorPref(colorBehaviors);
        updateColorToggleLabel();
      };

      addTabBtn.onclick = () => addTab(tabs, editor);
      renameTabBtn.onclick = () => renameTab(tabs);
      deleteTabBtn.onclick = () => deleteTab(tabs, editor);
      insertDateBtn.onclick = () => insertDateHeadingAtEnd(editor);
      exportBtn.onclick = () => exportCurrentTab(editor);
      exportHtmlBtn.onclick = () => exportCurrentTabHtml(editor);
      printBtn.onclick = () => window.print();

      document.querySelectorAll(".quick-btn").forEach(btn => {
        btn.onclick = () => insertQuickEntry(btn.dataset.label, editor);
      });

      // Enter ‚Üí ny tidsrad l√§ngst ned (utan label)
      editor.addEventListener("keydown", e => {
        if (e.key === "Enter") {
          e.preventDefault();
          insertQuickEntry("", editor);
        }
      });

      editor.addEventListener("input", () => {
        const t = getActiveTab();
        if (t) {
          t.content = editor.innerHTML;
          saveState();
        }
      });
    };
  </script>
</body>
</html>
