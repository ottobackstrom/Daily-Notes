<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <title>Skolg√•ngshandledarappen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <!-- iPhone App-st√∂d -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Skolg√•ngshandledarappen" />
  <meta name="theme-color" content="#F2F2F7" />
  <link rel="apple-touch-icon" href="icon-193.png" />
  <link rel="manifest" href="manifest.webmanifest" />

  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --ios-bg: #f2f2f7;
      --ios-surface: #ffffff;
      --ios-separator: rgba(60, 60, 67, 0.29);
      --ios-secondary: rgba(60, 60, 67, 0.6);
      --ios-label: #000000;
      --ios-accent: #007aff;
      --ios-destructive: #ff3b30;
      --ios-success: #34c759;
      --radius-pill: 999px;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: var(--ios-bg);
      color: var(--ios-label);
      width: 100%;
      overflow-x: hidden;
    }

    /* ====== FULLBREDD APP ====== */

    .app {
      width: 100%;
      margin: 0;
      padding: 0 1rem;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--ios-bg);
    }

    /* ======= TOPP-NAV BAR ======= */

    .nav-bar {
      position: sticky;
      top: 0;
      width: 100%;
      z-index: 10;
      background: rgba(242,242,247,0.97);
      backdrop-filter: blur(20px);
      border-bottom: 0.5px solid var(--ios-separator);
      padding: 0.6rem 1rem 0.55rem;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .nav-title {
      font-size: 18px;
      font-weight: 600;
      text-align: center;
    }

    .nav-subtitle {
      font-size: 12px;
      text-align: center;
      color: var(--ios-secondary);
    }

    /* ======= FLIKAR ======= */

    .tabs-shell {
      width: 100%;
      display: flex;
      gap: 0.5rem;
    }

    .tabs-container {
      flex: 1;
      display: flex;
      overflow-x: auto;
      gap: 0.35rem;
      scrollbar-width: none;
    }

    .tabs-container::-webkit-scrollbar {
      display: none;
    }

    .tab {
      border-radius: var(--radius-pill);
      border: 0.5px solid transparent;
      background: #e5e5ea;
      color: #3c3c43;
      font-size: 14px;
      padding: 0.3rem 0.75rem;
      flex: 0 0 auto;
      white-space: nowrap;
    }

    .tab.active {
      background: var(--ios-surface);
      border-color: var(--ios-separator);
      color: var(--ios-accent);
      font-weight: 600;
    }

    .tab-add {
      border-radius: 999px;
      background: #e5e5ea;
      width: 32px;
      height: 32px;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ======= INNEH√ÖLL ======= */

    .hint {
      font-size: 12px;
      color: var(--ios-secondary);
      margin-top: 0.6rem;
    }

    textarea {
      width: 100%;
      margin-top: 0.5rem;
      border: none;
      border-radius: 12px;
      padding: 0.9rem;
      font-size: 16px;
      line-height: 1.5;
      background: var(--ios-surface);
      box-shadow: 0 0 0 0.5px rgba(60,60,67,0.2);
      resize: none;
      min-height: 55vh;
    }

    /* ======= NEDRE VERKTYGF√ÑLT ======= */

    .bottom-toolbar {
      width: 100%;
      position: sticky;
      bottom: 0;
      background: rgba(242,242,247,0.97);
      backdrop-filter: blur(20px);
      border-top: 0.5px solid var(--ios-separator);
      padding: 0.8rem 1rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .bottom-section-title {
      font-size: 12px;
      text-transform: uppercase;
      color: var(--ios-secondary);
    }

    .bottom-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    /* ======= ST√ñRRE KNAPPAR ======= */

    .control-btn {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      border-radius: var(--radius-pill);
      border: 0.5px solid rgba(60,60,67,0.25);
      background: var(--ios-surface);
      font-size: 14px;
      padding: 0.45rem 1rem;
      min-height: 38px;
    }

    .control-btn.primary { color: var(--ios-accent); }
    .control-btn.destructive { color: var(--ios-destructive); }

    .chip-btn {
      border-radius: var(--radius-pill);
      border: 0.5px solid rgba(60,60,67,0.2);
      padding: 0.4rem 1rem;
      font-size: 13px;
      min-height: 36px;
      background: var(--ios-surface);
    }

    .chip-btn.destructive { color: var(--ios-destructive); }
    .chip-btn.success { color: var(--ios-success); }

    .bottom-label {
      font-size: 11px;
      color: var(--ios-secondary);
    }

    /* ======= DARK MODE ======= */

body.dark {
  background: #000;
}

body.dark textarea {
  background: #1c1c1e;
  color: white;
  box-shadow: 0 0 0 0.5px rgba(80,80,85,0.6);
}

body.dark .nav-bar,
body.dark .bottom-toolbar {
  background: rgba(22,22,24,0.94);
  border-color: rgba(84,84,88,0.6);
}

body.dark .nav-title,
body.dark .nav-subtitle,
body.dark .hint,
body.dark .bottom-section-title,
body.dark .bottom-label {
  color: rgba(240,240,245,0.9);
}

body.dark .tab {
  background: #3a3a3c;
  color: #f2f2f7;
}

body.dark .tab.active {
  background: #1c1c1e;
  color: #0a84ff;
}

/* Beh√•ll app-knappar neutrala i dark mode */
body.dark .control-btn {
  background: #1c1c1e;
  border-color: rgba(84,84,88,0.6);
  color: #f2f2f7;
}

/* Beteendeknappar ‚Äì tydliga i dark mode */
body.dark .chip-btn {
  background: #1c1c1e;
  border-color: rgba(84,84,88,0.6);
}

body.dark .chip-btn.destructive {
  color: #ff453a;
  background: rgba(255,69,58,0.16);
  border-color: rgba(255,69,58,0.7);
}

body.dark .chip-btn.success {
  color: #30d158;
  background: rgba(48,209,88,0.16);
  border-color: rgba(48,209,88,0.7);
}
  </style>
</head>


<body>
  <div class="app">

    <!-- TOPP -->
    <header class="nav-bar">
      <div class="nav-title">SGHL-Logg</div>
      <div class="nav-subtitle" id="currentTabTitle">Elev 1</div>

      <div class="tabs-shell">
        <div class="tabs-container" id="tabs"></div>
        <button class="tab-add" id="addTabBtn">Ôºã</button>
      </div>
    </header>

    <!-- INNEH√ÖLL -->
    <p class="hint">Varje ny rad b√∂rjar automatiskt med aktuell tid (HH:MM).</p>
    <textarea id="notes" placeholder="Ny logg..."></textarea>

    <!-- NEDRE PANEL -->
    <footer class="bottom-toolbar">

      <div>
        <div class="bottom-section-title">App-kontroller</div>
        <div class="bottom-row">
          <button class="control-btn primary" id="renameTabBtn">‚úèÔ∏è Byt namn</button>
          <button class="control-btn destructive" id="deleteTabBtn">üóëÔ∏è Ta bort flik</button>
          <button class="control-btn" id="insertDateBtn">üìÖ Datum</button>
          <button class="control-btn" id="exportBtn">‚¨áÔ∏è Export .txt</button>
          <button class="control-btn" id="themeToggleBtn"><span id="themeIcon">‚òÄÔ∏è</span> Tema</button>
        </div>
      </div>

      <div>
        <div class="bottom-section-title">Snabbknappar ‚Äì beteende</div>
        <div class="bottom-row">
          <button class="chip-btn destructive quick-btn" data-label="Sl√•ss">Sl√•ss</button>
          <button class="chip-btn destructive quick-btn" data-label="Anv√§nder fula ord">Fula ord</button>
          <button class="chip-btn destructive quick-btn" data-label="Tjafsar emot">Tjafsar emot</button>
          <button class="chip-btn destructive quick-btn" data-label="Uppe och g√•r">Uppe och g√•r</button>
          <button class="chip-btn success quick-btn" data-label="Ber om urs√§kt">Ber om urs√§kt</button>
        </div>
        <div class="bottom-label">Automatisk tidsst√§mpel aktiv</div>
      </div>

    </footer>
  </div>

  <script>
    const STORAGE_KEY = 'timeNotesApp_v1';
    const THEME_KEY = 'timeNotesApp_theme';
    let state = { tabs: [], activeId: null };

    function currentDateHeading() {
      const d = new Date();

      const veckodagar = ["S√∂ndag","M√•ndag","Tisdag","Onsdag","Torsdag","Fredag","L√∂rdag"];
      const m√•nader = ["januari","februari","mars","april","maj","juni","juli","augusti",
        "september","oktober","november","december"];

      return `=== ${veckodagar[d.getDay()]} ${d.getDate()} ${m√•nader[d.getMonth()]} ${d.getFullYear()} ===`;
    }

    function currentTimeString() {
      const d = new Date();
      return `${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")} `;
    }

    function loadState() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) { try { state = JSON.parse(raw); } catch {} }
      if (state.tabs.length === 0) {
        const id = String(Date.now());
        state.tabs = [{ id, name: "Elev 1", content: "" }];
        state.activeId = id;
        saveState();
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function getActiveTab() {
      return state.tabs.find(t => t.id === state.activeId);
    }

    function updateNavSubtitle() {
      document.getElementById("currentTabTitle").textContent = getActiveTab().name;
    }

    function renderTabs(container, ta) {
      container.innerHTML = "";
      state.tabs.forEach(tab => {
        const b = document.createElement("button");
        b.className = "tab" + (tab.id === state.activeId ? " active" : "");
        b.textContent = tab.name;
        b.onclick = () => switchTab(tab.id, container, ta);
        container.appendChild(b);
      });
      updateNavSubtitle();
    }

    function switchTab(id, container, ta) {
      getActiveTab().content = ta.value;
      state.activeId = id;
      saveState();
      ta.value = getActiveTab().content;
      ensureFirstLineHasDateAndTime(ta);
      renderTabs(container, ta);
    }

    function addTab(container, ta) {
      const name = prompt("Namn p√• ny elev:");
      if (!name) return;
      const id = Date.now() + "_" + Math.random();
      state.tabs.push({ id, name: name.trim(), content: "" });
      state.activeId = id;
      saveState();
      renderTabs(container, ta);
      ta.value = "";
      ensureFirstLineHasDateAndTime(ta);
    }

    function ensureFirstLineHasDateAndTime(ta) {
      if (!ta.value.trim()) {
        ta.value = currentDateHeading() + "\n" + currentTimeString();
      }
    }

    function insertDateHeadingAtCursor(ta) {
      const pos = ta.selectionStart;
      const insert = "\n" + currentDateHeading() + "\n" + currentTimeString();
      ta.value = ta.value.slice(0, pos) + insert + ta.value.slice(pos);
      ta.selectionStart = ta.selectionEnd = pos + insert.length;
      getActiveTab().content = ta.value;
      saveState();
    }

    function exportCurrentTab(ta) {
      const tab = getActiveTab();
      const header = `Elev: ${tab.name}\n\n`;
      const blob = new Blob([header + ta.value], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = tab.name.replace(/\W+/g, "_") + ".txt";
      a.click();
      URL.revokeObjectURL(url);
    }

    function insertQuickEntry(label, ta) {
      const pos = ta.selectionStart;
      const insert = "\n\n" + currentTimeString() + label;
      ta.value = ta.value.slice(0, pos) + insert + ta.value.slice(pos);
      ta.selectionStart = ta.selectionEnd = pos + insert.length;
      getActiveTab().content = ta.value;
      saveState();
    }

    function loadTheme() {
      return localStorage.getItem(THEME_KEY) || "light";
    }

    function applyTheme(t) {
      document.body.classList.toggle("dark", t === "dark");
      document.getElementById("themeIcon").textContent = t === "dark" ? "üåô" : "‚òÄÔ∏è";
    }

    function saveTheme(t) {
      localStorage.setItem(THEME_KEY, t);
    }

    /* INIT */
    window.onload = () => {
      const ta = document.getElementById("notes");
      const tabs = document.getElementById("tabs");

      loadState();
      renderTabs(tabs, ta);

      ta.value = getActiveTab().content;
      ensureFirstLineHasDateAndTime(ta);

      document.getElementById("addTabBtn").onclick = () => addTab(tabs, ta);
      document.getElementById("renameTabBtn").onclick = () => {
        const t = getActiveTab();
        const n = prompt("Nytt namn:", t.name);
        if (!n) return;
        t.name = n.trim();
        saveState();
        renderTabs(tabs, ta);
      };
      document.getElementById("deleteTabBtn").onclick = () => {
        if (state.tabs.length <= 1) return alert("Minst en flik kr√§vs.");
        if (!confirm("Ta bort fliken?")) return;
        const id = getActiveTab().id;
        state.tabs = state.tabs.filter(x => x.id !== id);
        state.activeId = state.tabs[0].id;
        saveState();
        renderTabs(tabs, ta);
        ta.value = getActiveTab().content;
      };
      document.getElementById("insertDateBtn").onclick = () => insertDateHeadingAtCursor(ta);
      document.getElementById("exportBtn").onclick = () => exportCurrentTab(ta);

      document.querySelectorAll(".quick-btn").forEach(btn =>
        btn.onclick = () => insertQuickEntry(btn.dataset.label, ta)
      );

      ta.addEventListener("keydown", e => {
        if (e.key === "Enter") {
          e.preventDefault();
          insertQuickEntry("", ta);
        }
      });

      ta.addEventListener("input", () => {
        getActiveTab().content = ta.value;
        saveState();
      });

      let theme = loadTheme();
      applyTheme(theme);
      document.getElementById("themeToggleBtn").onclick = () => {
        theme = theme === "dark" ? "light" : "dark";
        applyTheme(theme);
        saveTheme(theme);
      };
    };
  </script>
</body>
</html>
